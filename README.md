# ğŸ¼Siren Intro

`Siren`æ˜¯ä¸€æ¬¾ç®€å•(~~la ji~~)çš„Webæ¼æ´æ‰«æå™¨ï¼ˆå­¦ä¹ ä¸“ç”¨ï¼Œä½œè€…çš„è¯¾è®¾ğŸ’¦ï¼‰

`Siren`ä¸ºå¤å¸Œè…Šç¥è¯ä¸­äººé¦–é¸Ÿèº«çš„å¥³æµ·å¦–ğŸŸğŸ’ƒï¼Œä»¥ç¾å¦™æ­Œå£°ğŸµè¯±ä½¿èˆªæµ·è€…é©¶å‘ç¤çŸ³æˆ–è¿›å…¥å±é™©æ°´åŸŸâ˜ 

ğŸ¤ åœ¨è·é©¬å²è¯—ä¸­ï¼Œå½“å¥¥å¾·ä¿®æ–¯å°†è¦ç»è¿‡å¡å£¬æ‰€åœ¨æµ·å²›æ—¶ï¼Œå¾—åˆ°å¥³ç¥çš„å¿ å‘Šï¼Œé¢„å…ˆé‡‡å–äº†é˜²å¤‡æªæ–½ã€‚ä»–å‘½ä»¤æ‰‹ä¸‹æŠŠè‡ªå·±ç‰¢ç‰¢åœ°ç»‘åœ¨æ¡…æ†ä¸Šï¼Œè®©æ‰‹ä¸‹ç”¨èœ¡æŠŠå„äººçš„è€³æœµå µä¸ŠğŸ£

ğŸ“¢åœ¨17ä¸–çºªï¼Œäººä»¬ä¸ºäº†é˜²æ­¢èˆ¹åªè§¦ç¤ï¼Œå°±åœ¨æš—ç¤é™„è¿‘ç”¨æ±½ç¬›å‘å‡ºè­¦æŠ¥ã€‚ç”±äºè¿™ç§è­¦æŠ¥å£°å°±åƒå¡å£¬çš„æ­Œå£°ä¸€æ ·é¢„ç¤ºç€å±é™©ï¼Œæ‰€ä»¥äººä»¬å°±æŠŠè¿™ç§è­¦æŠ¥å£°å«åš`Siren`

Webåº”ç”¨èƒŒååŒæ ·ä¹Ÿå¯èƒ½éšè—ç€è‡´å‘½çš„æ¼æ´ï¼Œè¯¥æ¼æ´æ‰«æå™¨æ—¨åœ¨ç»™Webåº”ç”¨åšå‡ºæ¼æ´æŠ¥è­¦ï¼Œç»™å‡ºæ‰«ææŠ¥å‘Šä¾›å¼€å‘æµ‹è¯•äººå‘˜å‚è€ƒï¼Œä»¥åŠæ—¶ä¿®è¡¥æ¼æ´ã€‚

ï¼ˆå¦‚æœä½ è§‰å¾—æœ¬é¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œèƒ½ç»™ä¸ªstarå°±å¤ªå¥½äº†ï¼‰

å¯é€šè¿‡`VulHub`è‡ªæ­é¶åœºæµ‹è¯•

> æ³¨ï¼šé¡¹ç›®ä¸­RCEå‡æ‰§è¡Œ`id`å‘½ä»¤
>
> å¯¹äºæ–‡ä»¶ä»»æ„è¯»å–å‡è¯»å–`/etc/passwd`
>
> å¯¹äºä¸èƒ½å›æ˜¾çš„RCEä½¿ç”¨DNSå¤–å¸¦ï¼Œ`dnslog.cn`å¯èƒ½ä¸ç¨³å®š

# ğŸ”§Usage

* å¼€å‘è¯­è¨€ï¼šPython3.9

* è¿è¡Œä¾èµ–ï¼šChromeæµè§ˆå™¨ã€ChromeDriver

* æ¼æ´æ”¯æŒï¼š25ä¸ªæ¼æ´

<details>
<summary>æ”¯æŒçš„æ¼æ´åˆ—è¡¨ [ç‚¹å‡»å±•å¼€] </summary>
[+] XSS
<br> [+] SQLI
<br> [+] FastJson
<br> [+] Struts2 S2-001
<br> [+] Struts2 S2-005
<br> [+] Struts2 S2-007
<br> [+] Struts2 S2-008
<br> [+] Struts2 S2-013
<br> [+] Struts2 S2-015
<br> [+] Struts2 S2-016
<br> [+] Struts2 S2-032
<br> [+] Struts2 S2-045
<br> [+] Struts2 S2-046
<br> [+] Struts2 S2-053
<br> [+] Struts2 S2-057
<br> [+] Struts2 S2-061
<br> [+] Apache Solr RCE CVE-2017-12629
<br> [+] Apache Solr XXE CVE-2017-12629
<br> [+] Apache Solr RCE CVE-2019-17558
<br> [+] Apache Solr RemoteStreaming Arbitrary File Reading and SSRF
<br> [+] Apache Flink Path Traversal CVE-2020-17519
<br> [+] ThinkPHP 2.x RCE
<br> [+] Thinkphp5 5.0.22/5.1.29 RCE
<br> [+] ThinkPHP5 5.0.23 RCE
<br> [+] Thinkphp6 Lang LFI
</details>

## ç›´æ¥è¿è¡Œ

è‹¥è¦ç›´æ¥åœ¨æœ¬æœºè¿è¡Œï¼Œè¯·ç¡®ä¿æœ¬æœºè£…æœ‰æœ€æ–°ç‰ˆChromeæµè§ˆå™¨

ï¼ˆç¬¬ä¸€æ¬¡è¿è¡Œä¼šåœ¨å·¥ç¨‹ç›®å½•ä¸‹ï¼Œè‡ªåŠ¨ä¸‹è½½æœ€æ–°ç‰ˆChrome Driverï¼‰

* --help æŸ¥çœ‹å‚æ•°ä½¿ç”¨è¯´æ˜

`python scan.py --help`

> Usage: scan.py [OPTIONS]
>
> A tiny little scanner for vul detection
>
> Options:
>
> -u, --url TEXT                  url to scan
>
> -n, --num INTEGER               process number in scanning  [default: 1]
>
> -p, --program [all|php|java]    specify the backend program language when searching directories
>
> -c, --custom [Fastjson|Flink|Solr|Struts2|ThinkPHP] Customization Mode Else Traditional Mode
>
> --dir-brute                     discover potential web path
>
> --risk [0|1|2|3|4|5|6|7|8|9|10] The higher risk, the faster dirsearch work [default: 5]
>
> -l, --show                      list all the vuls supported
>
> --help                          Show this message and exit.

* -u, --url            æŒ‡å®šæ‰«æçš„url
* -n, --num          æŒ‡å®šç›®å½•æ‰«æå’ŒSQLç›²æ³¨çš„è¿›ç¨‹æ•°
* -p, --program    æŒ‡å®šç›®å½•æ‰«æå¯¹åº”çš„åç«¯è¯­è¨€
* -c, --custom      æŒ‡å®šæ‰«æçš„ç‰¹æ®Šæ¼æ´ç±»å‹
* --dir-brute         å¼€å¯ç›®å½•æ‰«æ
* --risk                æ§åˆ¶å‘åŒ…é€Ÿç‡ï¼Œriskè¶Šé«˜å‘åŒ…è¶Šå¿«
* -l, --show          æ‰“å°æ”¯æŒçš„æ‰€æœ‰æ¼æ´

## Dockerç¯å¢ƒ

```sh
docker build . -t siren
docker run -it --name Siren siren /bin/bash
```

# ğŸ“ºDemo

![image-20230629132427796](imgs/image-20230629132427796.png)

![image-20230629132524848](imgs/image-20230629132524848.png)

![image-20230629132622625](imgs/image-20230629132622625.png)

![image-20230629132655947](imgs/image-20230629132655947.png)

# ğŸ©å…è´£å£°æ˜

æœ¬å·¥å…·ä»…é¢å‘åˆæ³•æˆæƒçš„ä¼ä¸šå®‰å…¨å»ºè®¾è¡Œä¸ºï¼Œåœ¨ä½¿ç”¨æœ¬å·¥å…·è¿›è¡Œæ£€æµ‹æ—¶ï¼Œæ‚¨åº”ç¡®ä¿è¯¥è¡Œä¸ºç¬¦åˆå½“åœ°çš„æ³•å¾‹æ³•è§„ï¼Œå¹¶ä¸”å·²ç»å–å¾—äº†è¶³å¤Ÿçš„æˆæƒã€‚

å¦‚æ‚¨åœ¨ä½¿ç”¨æœ¬å·¥å…·çš„è¿‡ç¨‹ä¸­å­˜åœ¨ä»»ä½•éæ³•è¡Œä¸ºï¼Œæ‚¨éœ€è‡ªè¡Œæ‰¿æ‹…ç›¸åº”åæœï¼Œæˆ‘ä»¬å°†ä¸æ‰¿æ‹…ä»»ä½•æ³•å¾‹åŠè¿å¸¦è´£ä»»ã€‚

# ğŸ”Module Detail

## ç›®å½•ç»“æ„

![](imgs/structure.png)

## æ‰§è¡Œæµç¨‹

![image-20230628132711899](imgs/image-20230628132711899.png)

## DNSç¼“å­˜

`lib/connection/dns.py`

é‡å†™äº†`socket.getaddrinfo`ï¼Œç»´æŠ¤ä¸€ä¸ª`dns_cache`å­—å…¸æ¥å­˜å‚¨hoståŠå…¶å¯¹åº”çš„IPä¿¡æ¯

è‹¥ç¼“å­˜ä¸­æŸ¥æ‰¾ä¸åˆ°hostï¼Œåˆ™è°ƒç”¨åŸ`socket.getaddrinfo`å‘èµ·DNSè¯·æ±‚

```python
from socket import getaddrinfo

dns_cache = {}


def get_cached_addr(*args, **kwargs):
    """
    override socket.getaddrinfo to get dns cached
    """
    host, port = args[:2]  # å‰ä¸¤ä¸ªå‚æ•°ä¸ºhostå’Œport
    if host not in dns_cache:
        dns_cache[host] = getaddrinfo(*args, **kwargs)
    return dns_cache[host]
```

å…¶ä»–æ¨¡å—æƒ³è¦å¼€å¯DNSç¼“å­˜ï¼Œåªéœ€æ·»åŠ å¦‚ä¸‹ä»£ç 

```python
import socket
from lib.connection.dns import get_cached_addr
socket.getaddrinfo = get_cached_addr
```

## é€Ÿç‡æ§åˆ¶

`lib/connection/rate.py`

åŒæ ·ä¹Ÿæ˜¯é‡å†™`socket.socket.connect`ï¼Œåœ¨è¿æ¥å‰åŠ ä¸Šå¤„ç†é€»è¾‘

```python
import time
from socket import socket
from lib.help.settings import RATE

# reserve the original connect function
_connect = socket.connect


def hooked_connect(*args, **kwargs):
    # print('connection hooked')
    time.sleep(RATE)
    _connect(*args, **kwargs)
```

å…¶ä»–æ¨¡å—æƒ³è¦å¼€å¯é€Ÿç‡æ§åˆ¶ï¼Œåªéœ€æ·»åŠ å¦‚ä¸‹ä»£ç 

```python
from socket import socket
from lib.connection.rate import hooked_connect

socket.connect = hooked_connect
```

åé¢çš„`crawl.py`ç”±äºä½¿ç”¨äº†`Selenium`å»æ§åˆ¶æµè§ˆå™¨ï¼Œä¸ä¼šå»è°ƒç”¨`socket.connect`

ä¸ºç®€ä¾¿åœ¨`driver.get(link)`ä¹‹ååŠ äº†`time.sleep`

## çˆ¬å–è§£ææ¨¡å—

`sniper/crawl.py`

ä¸ºé€‚åº”åŠ¨æ€æ¸²æŸ“çš„ç½‘é¡µï¼Œä½¿ç”¨`Selenium`æ¨¡æ‹Ÿæµè§ˆå™¨çˆ¬å–ç½‘é¡µ

### `Selenium`åçˆ¬

Jsæ£€æµ‹å½“å‰æµè§ˆå™¨çª—å£ä¸‹çš„ `window.navigator` å¯¹è±¡æ˜¯å¦åŒ…å« `webdriver` è¿™ä¸ªå±æ€§ã€‚

æ­£å¸¸ä½¿ç”¨æµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå±æ€§æ˜¯ `undefined`ï¼Œè€Œä½¿ç”¨`Selenium`ï¼Œè¿™ä¸ªå±æ€§è¢«åˆå§‹åŒ–ä¸º `true`

å¯ä»¥æƒ³åˆ°ä½¿ç”¨`Selenium`æä¾›çš„`execute_script`å°†`window.navigator` å¯¹è±¡ç½®ä¸º`undefined`

```javascript
Object.defineProperty(navigator, "webdriver", {get: () => undefined})
```

ä½†æ‰§è¡Œ`execute_script`æ—¶é¡µé¢å·²ç»åŠ è½½å®Œäº†ã€‚å¯ä»¥ä½¿ç”¨`execute_cdp_cmd`ï¼Œä¼šåœ¨ç½‘é¡µçš„jsæ‰§è¡Œå‰å…ˆæ‰§è¡Œ

```python
driver.execute_cdp_cmd("Page.addScriptToEvaluateOnNewDocument", {
    "source": "Object.defineProperty(navigator, 'webdriver', {get: () => undefined})"
})
```

å»é™¤ä¸€äº›`Selenium`ç‰¹å¾

```python
options = Options()
options.add_argument("--disable-blink-features")
options.add_argument("--disable-blink-features=AutomationControlled")
```

### è¸©å‘

ç”±äºåé¢å¼€äº†å¤šè¿›ç¨‹å»è·‘SQLIæ³¨å…¥æ£€æµ‹ï¼Œå­è¿›ç¨‹ä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥`webdriver.Chrome(options=options)`ä¸èƒ½æ”¾åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ï¼ˆå¦åˆ™ä¼šç–¯ç‹‚å¼¹æµè§ˆå™¨ï¼‰

### çˆ¬å–æµç¨‹

![image-20230524112234711](imgs/image-20230524112234711.png)

## ç›®å½•çˆ†ç ´æ¨¡å—

![image-20230524114811120](imgs/image-20230524114811120.png)

å®é™…ä¸Šæœ‰äº›ç½‘ç«™å°±ç®—è·¯å¾„ä¸å­˜åœ¨ä¹Ÿä¼šè¿”å›200çŠ¶æ€ç ï¼Œå› æ­¤ä»…é€šè¿‡çŠ¶æ€ç ä¸è¶³åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨

è¿˜å¾—è¯†åˆ«é¡µé¢æœ‰æ²¡æœ‰"è®¿é—®çš„èµ„æºä¸å­˜åœ¨"ç­‰å­—çœ¼

## æŒ‡çº¹è¯†åˆ«æ¨¡å—

![image-20230524140125523](imgs/image-20230524140125523.png)

è¯¥é¡¹ç›®åªåšäº†ç®€å•çš„å“åº”å¤´çš„ä¿¡æ¯æå–ã€‚

ä¸‹é¢è¯´è¯´å…¶ä»–æ£€æµ‹ç‚¹ï¼š

* `favicon`ï¼šå¦‚SpringBootã€ThinkPHPç­‰æ¡†æ¶çš„é»˜è®¤ç½‘ç«™logoå›ºå®šã€‚å¯ä»¥æ¯”å¯¹å…¶logoçš„md5å€¼

* æŠ¥é”™é¡µé¢ï¼šå‘é€ä¸å­˜åœ¨çš„è·¯å¾„ï¼Œè‹¥æ²¡è®¾ç½®å…¨å±€å¼‚å¸¸å¤„ç†ï¼ŒSpringBootè¿”å›`Whitelabel Error Page`

  ![image-20230524134439171](imgs/image-20230524134439171.png)

  ThinkPHPè¿”å›å¦‚ä¸‹
  ![image-20230524134351256](imgs/image-20230524134351256.png)

* é¡µé¢æ ‡ç­¾å±æ€§ã€‚æœ‰äº›CMSçš„é¡µé¢æ ‡ç­¾å±æ€§å°±æŒ‡æ˜äº†è¯¥CMS

## XSSæ¨¡å—

![image-20230620213122433](imgs/image-20230620213122433.png)

å‚è€ƒé¡¹ç›®ï¼š

* [menkrep1337/XSSCon: XSSCon: Simple XSS Scanner tool (github.com)](https://github.com/menkrep1337/XSSCon)
* [w-digital-scanner/w13scan: Passive Security Scanner (è¢«åŠ¨å¼å®‰å…¨æ‰«æå™¨) (github.com)](https://github.com/w-digital-scanner/w13scan)

## SQLIæ¨¡å—

![image-20230620213153579](imgs/image-20230620213153579.png)

å‚è€ƒé¡¹ç›®ï¼š

[stamparm/DSSS: Damn Small SQLi Scanner (github.com)](https://github.com/stamparm/DSSS)

ï¼ˆè¿™ä¸ªäººæ˜¯SQLMapçš„ä½œè€…ä¹‹ä¸€ï¼‰

## DNSlogç›²æ‰“

DNSlogå°±æ˜¯DNSçš„æ—¥å¿—ï¼ŒDNSåœ¨è§£æçš„æ—¶å€™ä¼šç•™ä¸‹æ—¥å¿—ï¼Œå¯ä»¥åœ¨æ—¥å¿—ä¸­è¯»å–è‡ªå·±åŸŸåçš„è§£ææƒ…å†µ

DNSlogå¯ç”¨äºå¤–å¸¦æ•°æ®ï¼Œç”¨äºå‘½ä»¤æ‰§è¡Œç»“æœä¸å›æ˜¾çš„æƒ…å†µ

ä¸€ä¸ªåŸŸåçš„æ„æˆä¸ºï¼šå­åŸŸå + æƒå¨åŸŸå + é¡¶çº§åŸŸå

![image-20230627100925162](imgs/image-20230627100925162.png)

ä¸‹çº§åŸŸåçš„è§£æç”±ä¸Šçº§ç®¡ç†ï¼Œå¦‚ä¸‹`test.wxcwf6.dnslog.cn`çš„è§£æéœ€è¦ç»è¿‡`wxcwf6.dnslog.cn`ï¼ŒDNSlogå¹³å°ä¼šè·å–å…³äºè§£æ`wxcwf6.dnslog.cn`çš„æ‰€æœ‰è®°å½•

ä¸‹é¢funå’Œtestè¿™ä¸¤ä¸ªå­åŸŸåéƒ½è§£æåˆ°äº†åŒä¸€ä¸ªIPåœ°å€

![image-20230627102517618](imgs/image-20230627102517618.png)

æŠŠå‘½ä»¤æ‰§è¡Œçš„ç»“æœä½œä¸ºå­åŸŸåå»æŸ¥è¯¢ï¼Œåœ¨DNSlogå¹³å°å°±èƒ½æ‰¾åˆ°è¿™æ¡è®°å½•ï¼Œè¿›è€Œè·å–å‘½ä»¤æ‰§è¡Œç»“æœ

ä½†å¯¹äºæ¼æ´æ£€æµ‹ï¼Œæˆ‘ä»¬åªéœ€è¯æ˜å…¶èƒ½å‘é€DNSè¯·æ±‚å°±èƒ½è¯æ˜å…¶æ‰§è¡Œäº†æˆ‘ä»¬çš„å‘½ä»¤

![image-20230627102604914](imgs/image-20230627102604914.png)

å…è´¹DNSlogå¹³å°ï¼š

* http://www.dnslog.cn/
* http://ceye.io
